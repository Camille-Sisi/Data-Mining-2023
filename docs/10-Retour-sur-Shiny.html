<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 10 Application sur Shiny | DATA MINING</title>
  <meta name="description" content="Titre du cours" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 10 Application sur Shiny | DATA MINING" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Titre du cours" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 10 Application sur Shiny | DATA MINING" />
  
  <meta name="twitter:description" content="Titre du cours" />
  

<meta name="author" content="Camille Signoretto, Maîtresse de conférences en économie, Université Paris Cité" />


<meta name="date" content="2023-05-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="09-Ggplot-pratique.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Mining :  <em>Camille Signoretto</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#à-propos-de-ce-document"><i class="fa fa-check"></i>À propos de ce document</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#prérequis"><i class="fa fa-check"></i>Prérequis</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="part"><span><b>Séance 1 : Data Wrangling</b></span></li>
<li class="chapter" data-level="1" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html"><i class="fa fa-check"></i><b>1</b> Récupération de la base de données</a>
<ul>
<li class="chapter" data-level="1.1" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html#les-données-du-recensement-de-la-population-rp"><i class="fa fa-check"></i><b>1.1</b> Les données du Recensement de la Population (RP)</a></li>
<li class="chapter" data-level="1.2" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html#quelles-informations-intéressantes-dans-cette-base"><i class="fa fa-check"></i><b>1.2</b> Quelles informations intéressantes dans cette base ?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html"><i class="fa fa-check"></i><b>2</b> Manipulation de la base</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html#format-des-données---wide-ou-long"><i class="fa fa-check"></i><b>2.1</b> Format des données - WIDE ou LONG</a></li>
<li class="chapter" data-level="2.2" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html#sélectionner-un-champ-réduit-de-la-base-séparer-les-données"><i class="fa fa-check"></i><b>2.2</b> Sélectionner un champ réduit de la base, séparer les données</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html"><i class="fa fa-check"></i><b>3</b> Manipulation des variables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#manipulation-des-variables-qualitatives"><i class="fa fa-check"></i><b>3.1</b> Manipulation des variables qualitatives</a></li>
<li class="chapter" data-level="3.2" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#manipulation-des-variables-quantitatives"><i class="fa fa-check"></i><b>3.2</b> Manipulation des variables quantitatives</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#détecter-et-visualiser-les-valeurs-manquantes"><i class="fa fa-check"></i><b>3.2.1</b> Détecter et “visualiser” les valeurs manquantes</a></li>
<li class="chapter" data-level="3.2.2" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#gérer-les-valeurs-manquantes"><i class="fa fa-check"></i><b>3.2.2</b> Gérer les valeurs manquantes</a></li>
<li class="chapter" data-level="3.2.3" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#détecter-et-visualiser-les-valeurs-aberrantes"><i class="fa fa-check"></i><b>3.2.3</b> Détecter et “visualiser” les valeurs aberrantes</a></li>
<li class="chapter" data-level="3.2.4" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#découper-en-classes-une-variable-quantitative"><i class="fa fa-check"></i><b>3.2.4</b> Découper en classes une variable quantitative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html"><i class="fa fa-check"></i><b>4</b> Récapitulatig séance 1 - Data Wrangling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html#ce-quon-a-appris"><i class="fa fa-check"></i><b>4.1</b> Ce qu’on a appris</a></li>
<li class="chapter" data-level="4.2" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html#enregistrement-des-tables"><i class="fa fa-check"></i><b>4.2</b> Enregistrement des tables</a></li>
</ul></li>
<li class="part"><span><b>Séance 2 : Data Mining - Analyse descriptive</b></span></li>
<li class="chapter" data-level="5" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html"><i class="fa fa-check"></i><b>5</b> Quelles questions intéressantes pour une “fouille de données” sur cette base ?</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html#caractéristiques-des-logements-de-la-commune-de-paris"><i class="fa fa-check"></i><b>5.1</b> Caractéristiques des logements de la commune de Paris</a></li>
<li class="chapter" data-level="5.2" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html#systématiser-nos-procédures-construire-une-fonction"><i class="fa fa-check"></i><b>5.2</b> Systématiser nos procédures : construire une fonction</a></li>
</ul></li>
<li class="part"><span><b>Séance 3 : Introduction à ShinyApp</b></span></li>
<li class="chapter" data-level="6" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html"><i class="fa fa-check"></i><b>6</b> Les applications interactives avec Shiny App</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html#la-structure-générale-dune-application-shiny"><i class="fa fa-check"></i><b>6.1</b> La structure générale d’une application Shiny</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html#la-partie-ui"><i class="fa fa-check"></i><b>6.1.1</b> La partie “UI”</a></li>
<li class="chapter" data-level="6.1.2" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html#la-partie-server"><i class="fa fa-check"></i><b>6.1.2</b> La partie “Server”</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html#la-réactivité"><i class="fa fa-check"></i><b>6.2</b> La réactivité</a></li>
<li class="chapter" data-level="6.3" data-path="06-Intro-a-Shiny-theorique.html"><a href="06-Intro-a-Shiny-theorique.html#un-exemple-avec-le-code-du-script-par-défaut"><i class="fa fa-check"></i><b>6.3</b> Un exemple avec le code du script par défaut</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html"><i class="fa fa-check"></i><b>7</b> La création d’une application Shiny “pas à pas” avec l’une de nos bases de données</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html#application-vide"><i class="fa fa-check"></i><b>7.1</b> Application vide</a></li>
<li class="chapter" data-level="7.2" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html#ajout-dun-titre-et-dun-widget"><i class="fa fa-check"></i><b>7.2</b> Ajout d’un titre et d’un widget</a></li>
<li class="chapter" data-level="7.3" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html#ajout-dun-graphique"><i class="fa fa-check"></i><b>7.3</b> Ajout d’un graphique</a></li>
<li class="chapter" data-level="7.4" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html#modification-du-graphique-filtrer-selon-une-variable"><i class="fa fa-check"></i><b>7.4</b> Modification du graphique : filtrer selon une variable</a></li>
<li class="chapter" data-level="7.5" data-path="07-Intro-a-Shiny-exemples.html"><a href="07-Intro-a-Shiny-exemples.html#modification-du-graphique-selon-une-variable-au-choix-parmi-deux"><i class="fa fa-check"></i><b>7.5</b> Modification du graphique : selon une variable au choix parmi deux</a></li>
</ul></li>
<li class="part"><span><b>Séance 4 : Data Visualization</b></span></li>
<li class="chapter" data-level="8" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html"><i class="fa fa-check"></i><b>8</b> Data Visualization et Ggplot2 : aspects théoriques</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#présentation-générale-de-ggplot2"><i class="fa fa-check"></i><b>8.1</b> Présentation générale de Ggplot2</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-aesthetics-ou-arguments-esthétiques"><i class="fa fa-check"></i><b>8.1.1</b> Les “aesthetics” ou arguments esthétiques</a></li>
<li class="chapter" data-level="8.1.2" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-géométries"><i class="fa fa-check"></i><b>8.1.2</b> Les géométries</a></li>
<li class="chapter" data-level="8.1.3" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-facettes"><i class="fa fa-check"></i><b>8.1.3</b> Les facettes</a></li>
<li class="chapter" data-level="8.1.4" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-statistiques"><i class="fa fa-check"></i><b>8.1.4</b> Les statistiques</a></li>
<li class="chapter" data-level="8.1.5" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-coordonnées"><i class="fa fa-check"></i><b>8.1.5</b> Les coordonnées</a></li>
<li class="chapter" data-level="8.1.6" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-thèmes"><i class="fa fa-check"></i><b>8.1.6</b> Les thèmes</a></li>
<li class="chapter" data-level="8.1.7" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-autres-options-graphiques-titres-échelles-des-axes-etc."><i class="fa fa-check"></i><b>8.1.7</b> Les autres options graphiques : titres, échelles des axes, etc.</a></li>
<li class="chapter" data-level="8.1.8" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#code-minimal"><i class="fa fa-check"></i><b>8.1.8</b> Code minimal</a></li>
<li class="chapter" data-level="8.1.9" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#liens-utiles-pour-aller-plus-loin"><i class="fa fa-check"></i><b>8.1.9</b> Liens utiles pour aller plus loin</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="08-Ggplot-theorique.html"><a href="08-Ggplot-theorique.html#les-grands-principes-de-data-visualization"><i class="fa fa-check"></i><b>8.2</b> Les grands principes de data visualization</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html"><i class="fa fa-check"></i><b>9</b> Le package Ggplot en pratiques</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#exemple-de-la-construction-dun-graphique-pas-à-pas"><i class="fa fa-check"></i><b>9.1</b> Exemple de la construction d’un graphique pas à pas</a></li>
<li class="chapter" data-level="9.2" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#dautres-exemples-à-travers-des-exercices"><i class="fa fa-check"></i><b>9.2</b> D’autres exemples à travers des exercices</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#distribution-du-prix-au-m2-pour-les-appartements-selon-les-arrondissements-de-paris"><i class="fa fa-check"></i><b>9.2.1</b> Distribution du prix au m2 pour les appartements, selon les arrondissements de Paris</a></li>
<li class="chapter" data-level="9.2.2" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#comparaison-des-montants-moyen-et-médian-du-prix-au-m2-par-département-de-paris-et-sa-petite-couronne"><i class="fa fa-check"></i><b>9.2.2</b> Comparaison des montants moyen et médian du prix au m2, par département de Paris et sa petite couronne</a></li>
<li class="chapter" data-level="9.2.3" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#evolution-du-prix-moyen-au-m2-des-ventes-dappartements-à-paris"><i class="fa fa-check"></i><b>9.2.3</b> Evolution du prix moyen au m2 des ventes d’appartements à Paris</a></li>
<li class="chapter" data-level="9.2.4" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#top-5-du-prix-au-m2-des-ventes-dappartements-selon-les-communes-ou-arrondissements"><i class="fa fa-check"></i><b>9.2.4</b> Top 5 du prix au m2 des ventes d’appartements selon les communes (ou arrondissements)</a></li>
<li class="chapter" data-level="9.2.5" data-path="09-Ggplot-pratique.html"><a href="09-Ggplot-pratique.html#à-vous-de-jouer"><i class="fa fa-check"></i><b>9.2.5</b> À vous de “jouer” !</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-Retour-sur-Shiny.html"><a href="10-Retour-sur-Shiny.html"><i class="fa fa-check"></i><b>10</b> Application sur Shiny</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-Retour-sur-Shiny.html"><a href="10-Retour-sur-Shiny.html#application-avec-un-tableau-et-un-graphique"><i class="fa fa-check"></i><b>10.1</b> Application avec un tableau et un graphique</a></li>
<li class="chapter" data-level="10.2" data-path="10-Retour-sur-Shiny.html"><a href="10-Retour-sur-Shiny.html#introduction-dune-réactivité-appliquée-à-la-table-de-données"><i class="fa fa-check"></i><b>10.2</b> Introduction d’une réactivité appliquée à la table de données</a></li>
<li class="chapter" data-level="10.3" data-path="10-Retour-sur-Shiny.html"><a href="10-Retour-sur-Shiny.html#introduction-dune-réactivité-sur-les-inputs-contexte-réactif"><i class="fa fa-check"></i><b>10.3</b> Introduction d’une réactivité sur les inputs (contexte réactif)</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DATA MINING</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c10-Retour-sur-Shiny" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Section 10</span> Application sur Shiny<a href="10-Retour-sur-Shiny.html#c10-Retour-sur-Shiny" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div align="justify">

<p>Nous pouvons maintenant mettre en pratique ces connaissances plus approfondies acquises sur le package <strong><code>Ggplot</code></strong>, en créant une application Shiny dont nous avions vu les bases lors de séances précédentes.</p>
<div id="application-avec-un-tableau-et-un-graphique" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Application avec un tableau et un graphique<a href="10-Retour-sur-Shiny.html#application-avec-un-tableau-et-un-graphique" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On va d’abord créer une application en mettant en haut un tableau général récapitulant pour la zone géographique étudiée les informations suivantes : le prix moyen au m2 et le nombre de ventes, respectivement des appartements et des maisons ; puis en-dessous de ce tableau, on va ajouter un graphique (barplot) qui va représenter le “top 5” du prix moyen au m2 des ventes, soit d’appartements, soit de maisons, et selon le département.<br />
Ainsi, le premier tableau ne sera pas à ce stade réactif, alors que le graphique le sera. Il y aura par conséquent deux widgets, l’un pour choisir le département et l’autre pour choisir le type de logement
Pour le tableau, vous pouvez utiliser le package <strong><code>gt()</code></strong> et la fonction <code>gt_output()</code> pour l’appel du tableau dans la partie <strong>UI</strong> associée à la fonction <code>render_gt()</code> dans la partie <strong>server</strong>.</p>
<p>Cela doit vous donner ceci :
<img src="images/Ex.1_Shiny.png" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="10-Retour-sur-Shiny.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement des librairies</span></span>
<span id="cb128-2"><a href="10-Retour-sur-Shiny.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb128-3"><a href="10-Retour-sur-Shiny.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb128-4"><a href="10-Retour-sur-Shiny.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb128-5"><a href="10-Retour-sur-Shiny.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb128-6"><a href="10-Retour-sur-Shiny.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb128-7"><a href="10-Retour-sur-Shiny.html#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="10-Retour-sur-Shiny.html#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="10-Retour-sur-Shiny.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement du fichier final</span></span>
<span id="cb128-10"><a href="10-Retour-sur-Shiny.html#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dvf &lt;- readRDS(&quot;data/dvfclean_V3.RDS&quot;)</span></span>
<span id="cb128-11"><a href="10-Retour-sur-Shiny.html#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="10-Retour-sur-Shiny.html#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="10-Retour-sur-Shiny.html#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb128-14"><a href="10-Retour-sur-Shiny.html#cb128-14" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb128-15"><a href="10-Retour-sur-Shiny.html#cb128-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb128-16"><a href="10-Retour-sur-Shiny.html#cb128-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements et de maisons dans Paris et sa petite couronne sur la période 2014-2021&quot;</span>),</span>
<span id="cb128-17"><a href="10-Retour-sur-Shiny.html#cb128-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-18"><a href="10-Retour-sur-Shiny.html#cb128-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb128-19"><a href="10-Retour-sur-Shiny.html#cb128-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-20"><a href="10-Retour-sur-Shiny.html#cb128-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb128-21"><a href="10-Retour-sur-Shiny.html#cb128-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb128-22"><a href="10-Retour-sur-Shiny.html#cb128-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb128-23"><a href="10-Retour-sur-Shiny.html#cb128-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb128-24"><a href="10-Retour-sur-Shiny.html#cb128-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département pour le graphique&quot;</span>,</span>
<span id="cb128-25"><a href="10-Retour-sur-Shiny.html#cb128-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(dvf<span class="sc">$</span>nom_dept),</span>
<span id="cb128-26"><a href="10-Retour-sur-Shiny.html#cb128-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Paris&quot;</span>),</span>
<span id="cb128-27"><a href="10-Retour-sur-Shiny.html#cb128-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>, </span>
<span id="cb128-28"><a href="10-Retour-sur-Shiny.html#cb128-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix du type de logement pour le graphique&quot;</span>, </span>
<span id="cb128-29"><a href="10-Retour-sur-Shiny.html#cb128-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb128-30"><a href="10-Retour-sur-Shiny.html#cb128-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb128-31"><a href="10-Retour-sur-Shiny.html#cb128-31" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb128-32"><a href="10-Retour-sur-Shiny.html#cb128-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-33"><a href="10-Retour-sur-Shiny.html#cb128-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb128-34"><a href="10-Retour-sur-Shiny.html#cb128-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb128-35"><a href="10-Retour-sur-Shiny.html#cb128-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb128-36"><a href="10-Retour-sur-Shiny.html#cb128-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb128-37"><a href="10-Retour-sur-Shiny.html#cb128-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb128-38"><a href="10-Retour-sur-Shiny.html#cb128-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb128-39"><a href="10-Retour-sur-Shiny.html#cb128-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb128-40"><a href="10-Retour-sur-Shiny.html#cb128-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb128-41"><a href="10-Retour-sur-Shiny.html#cb128-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb128-42"><a href="10-Retour-sur-Shiny.html#cb128-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb128-43"><a href="10-Retour-sur-Shiny.html#cb128-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-44"><a href="10-Retour-sur-Shiny.html#cb128-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-45"><a href="10-Retour-sur-Shiny.html#cb128-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-46"><a href="10-Retour-sur-Shiny.html#cb128-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-47"><a href="10-Retour-sur-Shiny.html#cb128-47" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb128-48"><a href="10-Retour-sur-Shiny.html#cb128-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-49"><a href="10-Retour-sur-Shiny.html#cb128-49" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb128-50"><a href="10-Retour-sur-Shiny.html#cb128-50" aria-hidden="true" tabindex="-1"></a>    dvf <span class="sc">%&gt;%</span> </span>
<span id="cb128-51"><a href="10-Retour-sur-Shiny.html#cb128-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb128-52"><a href="10-Retour-sur-Shiny.html#cb128-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Prix moyen au m2 des maisons, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span>, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb128-53"><a href="10-Retour-sur-Shiny.html#cb128-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>, ]<span class="sc">$</span>nblots),</span>
<span id="cb128-54"><a href="10-Retour-sur-Shiny.html#cb128-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes de maisons&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span>, ]<span class="sc">$</span>nblots)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-55"><a href="10-Retour-sur-Shiny.html#cb128-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb128-56"><a href="10-Retour-sur-Shiny.html#cb128-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-57"><a href="10-Retour-sur-Shiny.html#cb128-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">md</span>(<span class="st">&#39;**Principaux indicateurs sur Paris et sa petite couronne**&#39;</span>))</span>
<span id="cb128-58"><a href="10-Retour-sur-Shiny.html#cb128-58" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb128-59"><a href="10-Retour-sur-Shiny.html#cb128-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-60"><a href="10-Retour-sur-Shiny.html#cb128-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-61"><a href="10-Retour-sur-Shiny.html#cb128-61" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb128-62"><a href="10-Retour-sur-Shiny.html#cb128-62" aria-hidden="true" tabindex="-1"></a>  dvf <span class="sc">%&gt;%</span> </span>
<span id="cb128-63"><a href="10-Retour-sur-Shiny.html#cb128-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> input<span class="sc">$</span>type_logement <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb128-64"><a href="10-Retour-sur-Shiny.html#cb128-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom) <span class="sc">%&gt;%</span>  </span>
<span id="cb128-65"><a href="10-Retour-sur-Shiny.html#cb128-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">moy_prixm2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(prixm2))) <span class="sc">%&gt;%</span> </span>
<span id="cb128-66"><a href="10-Retour-sur-Shiny.html#cb128-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(moy_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-67"><a href="10-Retour-sur-Shiny.html#cb128-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> moy_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom, moy_prixm2))  <span class="sc">+</span> </span>
<span id="cb128-68"><a href="10-Retour-sur-Shiny.html#cb128-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb128-69"><a href="10-Retour-sur-Shiny.html#cb128-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>moy_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb128-70"><a href="10-Retour-sur-Shiny.html#cb128-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des communes ayant les prix moyens au m2 des </span><span class="sc">\n</span><span class="st">ventes&quot;</span>, </span>
<span id="cb128-71"><a href="10-Retour-sur-Shiny.html#cb128-71" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span>(input<span class="sc">$</span>type_logement<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>){<span class="st">&quot;d&#39;appartements&quot;</span>} <span class="cf">else</span>{<span class="st">&quot;de maisons&quot;</span>}, <span class="st">&quot;les plus élevés&quot;</span>,</span>
<span id="cb128-72"><a href="10-Retour-sur-Shiny.html#cb128-72" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;dans Paris&quot;</span>, </span>
<span id="cb128-73"><a href="10-Retour-sur-Shiny.html#cb128-73" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;en Seine-Saint-Denis&quot;</span>,</span>
<span id="cb128-74"><a href="10-Retour-sur-Shiny.html#cb128-74" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans les Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans le Val-de-Marne&quot;</span>)))),</span>
<span id="cb128-75"><a href="10-Retour-sur-Shiny.html#cb128-75" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb128-76"><a href="10-Retour-sur-Shiny.html#cb128-76" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2014-2021.&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-77"><a href="10-Retour-sur-Shiny.html#cb128-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb128-78"><a href="10-Retour-sur-Shiny.html#cb128-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb128-79"><a href="10-Retour-sur-Shiny.html#cb128-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb128-80"><a href="10-Retour-sur-Shiny.html#cb128-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb128-81"><a href="10-Retour-sur-Shiny.html#cb128-81" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb128-82"><a href="10-Retour-sur-Shiny.html#cb128-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-83"><a href="10-Retour-sur-Shiny.html#cb128-83" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb128-84"><a href="10-Retour-sur-Shiny.html#cb128-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-85"><a href="10-Retour-sur-Shiny.html#cb128-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-86"><a href="10-Retour-sur-Shiny.html#cb128-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-87"><a href="10-Retour-sur-Shiny.html#cb128-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-88"><a href="10-Retour-sur-Shiny.html#cb128-88" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Par rapport aux exemples précédents déjà réalisés sur Shiny, nous n’avons pas beaucoup ajouté de choses nouvelles : un peu de langage html (<code>br()</code>) pour insérer des espaces entre le tableau et le graphique, ou le titre général et le reste des éléments de l’application ; puis deux fonctions de condition à l’intérieur du <code>labs()</code> de <strong><code>Ggplot</code></strong> pour, d’une part, que le titre change selon le type de logement choisi par l’utilisateur (fonction <code>if(){} else{}</code>), et, d’autre part, que le titre change selon le département choisi (plusieurs fonctions <code>ifelse()</code>).</p>
</div>
<div id="introduction-dune-réactivité-appliquée-à-la-table-de-données" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Introduction d’une réactivité appliquée à la table de données<a href="10-Retour-sur-Shiny.html#introduction-dune-réactivité-appliquée-à-la-table-de-données" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On peut rendre maintenant la base de données réactive avec la fonction <code>reactive({})</code>. On l’avait vu, la fonction <code>reactive()</code> permet de créer un objet réactif qui est à la fois une entrée réactive et une sortie réactive, l’objet va donc se mettre à jour automatiquement si les entrées qu’il utilise changent, et il va automatiquement déclencher la mise à jour des sorties où il est utilisé.<br />
La fonction permet techniquement de décomposer du code réactif et est utile lorsque certaines parties du code sont utilisées par plusieurs outputs car elle va permettre alors d’éviter des redondances. Cela peut être le cas lorsqu’on doit filtrer et/ou sélectionner des mêmes variables en input pour plusieurs outputs.<br />
Ici, on va décomposer la partie ‘data’ du code précédent de la partie construction du graphique ; le rendu sera strictement le même ; mais cela peut être plus efficace en cas de long code et d’application complexe car en gros on va exécuter qu’une seule fois l’opération ‘data’ réalisée ici.<br />
Attention, la base réactive créée est une fonction, il faut donc l’appeler avec des parenthèses !</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="10-Retour-sur-Shiny.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement du fichier final</span></span>
<span id="cb129-2"><a href="10-Retour-sur-Shiny.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dvf &lt;- readRDS(&quot;data/dvfclean_V3.RDS&quot;)</span></span>
<span id="cb129-3"><a href="10-Retour-sur-Shiny.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="10-Retour-sur-Shiny.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="10-Retour-sur-Shiny.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb129-6"><a href="10-Retour-sur-Shiny.html#cb129-6" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb129-7"><a href="10-Retour-sur-Shiny.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb129-8"><a href="10-Retour-sur-Shiny.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements et de maisons dans Paris et sa petite couronne sur la période 2014-2021&quot;</span>),</span>
<span id="cb129-9"><a href="10-Retour-sur-Shiny.html#cb129-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-10"><a href="10-Retour-sur-Shiny.html#cb129-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb129-11"><a href="10-Retour-sur-Shiny.html#cb129-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-12"><a href="10-Retour-sur-Shiny.html#cb129-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb129-13"><a href="10-Retour-sur-Shiny.html#cb129-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb129-14"><a href="10-Retour-sur-Shiny.html#cb129-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb129-15"><a href="10-Retour-sur-Shiny.html#cb129-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb129-16"><a href="10-Retour-sur-Shiny.html#cb129-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département pour le graphique&quot;</span>,</span>
<span id="cb129-17"><a href="10-Retour-sur-Shiny.html#cb129-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(dvf<span class="sc">$</span>nom_dept),</span>
<span id="cb129-18"><a href="10-Retour-sur-Shiny.html#cb129-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Paris&quot;</span>),</span>
<span id="cb129-19"><a href="10-Retour-sur-Shiny.html#cb129-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>, </span>
<span id="cb129-20"><a href="10-Retour-sur-Shiny.html#cb129-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix du type de logement pour le graphique&quot;</span>, </span>
<span id="cb129-21"><a href="10-Retour-sur-Shiny.html#cb129-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb129-22"><a href="10-Retour-sur-Shiny.html#cb129-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb129-23"><a href="10-Retour-sur-Shiny.html#cb129-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb129-24"><a href="10-Retour-sur-Shiny.html#cb129-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-25"><a href="10-Retour-sur-Shiny.html#cb129-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb129-26"><a href="10-Retour-sur-Shiny.html#cb129-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb129-27"><a href="10-Retour-sur-Shiny.html#cb129-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb129-28"><a href="10-Retour-sur-Shiny.html#cb129-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb129-29"><a href="10-Retour-sur-Shiny.html#cb129-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb129-30"><a href="10-Retour-sur-Shiny.html#cb129-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb129-31"><a href="10-Retour-sur-Shiny.html#cb129-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb129-32"><a href="10-Retour-sur-Shiny.html#cb129-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb129-33"><a href="10-Retour-sur-Shiny.html#cb129-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb129-34"><a href="10-Retour-sur-Shiny.html#cb129-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb129-35"><a href="10-Retour-sur-Shiny.html#cb129-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb129-36"><a href="10-Retour-sur-Shiny.html#cb129-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-37"><a href="10-Retour-sur-Shiny.html#cb129-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-38"><a href="10-Retour-sur-Shiny.html#cb129-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-39"><a href="10-Retour-sur-Shiny.html#cb129-39" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb129-40"><a href="10-Retour-sur-Shiny.html#cb129-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-41"><a href="10-Retour-sur-Shiny.html#cb129-41" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb129-42"><a href="10-Retour-sur-Shiny.html#cb129-42" aria-hidden="true" tabindex="-1"></a>    dvf <span class="sc">%&gt;%</span> </span>
<span id="cb129-43"><a href="10-Retour-sur-Shiny.html#cb129-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb129-44"><a href="10-Retour-sur-Shiny.html#cb129-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Prix moyen au m2 des maisons, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span>, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb129-45"><a href="10-Retour-sur-Shiny.html#cb129-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>, ]<span class="sc">$</span>nblots),</span>
<span id="cb129-46"><a href="10-Retour-sur-Shiny.html#cb129-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes de maisons&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span>, ]<span class="sc">$</span>nblots)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-47"><a href="10-Retour-sur-Shiny.html#cb129-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb129-48"><a href="10-Retour-sur-Shiny.html#cb129-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-49"><a href="10-Retour-sur-Shiny.html#cb129-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">md</span>(<span class="st">&#39;**Principaux indicateurs sur Paris et sa petite couronne**&#39;</span>))</span>
<span id="cb129-50"><a href="10-Retour-sur-Shiny.html#cb129-50" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb129-51"><a href="10-Retour-sur-Shiny.html#cb129-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-52"><a href="10-Retour-sur-Shiny.html#cb129-52" aria-hidden="true" tabindex="-1"></a>  dvf_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb129-53"><a href="10-Retour-sur-Shiny.html#cb129-53" aria-hidden="true" tabindex="-1"></a>  dvf <span class="sc">%&gt;%</span> </span>
<span id="cb129-54"><a href="10-Retour-sur-Shiny.html#cb129-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> input<span class="sc">$</span>type_logement <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb129-55"><a href="10-Retour-sur-Shiny.html#cb129-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom) <span class="sc">%&gt;%</span>  </span>
<span id="cb129-56"><a href="10-Retour-sur-Shiny.html#cb129-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">moy_prixm2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(prixm2))) <span class="sc">%&gt;%</span> </span>
<span id="cb129-57"><a href="10-Retour-sur-Shiny.html#cb129-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(moy_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb129-58"><a href="10-Retour-sur-Shiny.html#cb129-58" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb129-59"><a href="10-Retour-sur-Shiny.html#cb129-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-60"><a href="10-Retour-sur-Shiny.html#cb129-60" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb129-61"><a href="10-Retour-sur-Shiny.html#cb129-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dvf_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-62"><a href="10-Retour-sur-Shiny.html#cb129-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> moy_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom, moy_prixm2))  <span class="sc">+</span> </span>
<span id="cb129-63"><a href="10-Retour-sur-Shiny.html#cb129-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb129-64"><a href="10-Retour-sur-Shiny.html#cb129-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>moy_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb129-65"><a href="10-Retour-sur-Shiny.html#cb129-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des communes ayant les prix moyens au m2 des </span><span class="sc">\n</span><span class="st">ventes&quot;</span>, </span>
<span id="cb129-66"><a href="10-Retour-sur-Shiny.html#cb129-66" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span>(input<span class="sc">$</span>type_logement<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>){<span class="st">&quot;d&#39;appartements&quot;</span>} <span class="cf">else</span>{<span class="st">&quot;de maisons&quot;</span>}, <span class="st">&quot;les plus élevés&quot;</span>,</span>
<span id="cb129-67"><a href="10-Retour-sur-Shiny.html#cb129-67" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;dans Paris&quot;</span>, </span>
<span id="cb129-68"><a href="10-Retour-sur-Shiny.html#cb129-68" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;en Seine-Saint-Denis&quot;</span>,</span>
<span id="cb129-69"><a href="10-Retour-sur-Shiny.html#cb129-69" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans les Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans le Val-de-Marne&quot;</span>)))),</span>
<span id="cb129-70"><a href="10-Retour-sur-Shiny.html#cb129-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb129-71"><a href="10-Retour-sur-Shiny.html#cb129-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2014-2021.&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-72"><a href="10-Retour-sur-Shiny.html#cb129-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb129-73"><a href="10-Retour-sur-Shiny.html#cb129-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb129-74"><a href="10-Retour-sur-Shiny.html#cb129-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb129-75"><a href="10-Retour-sur-Shiny.html#cb129-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb129-76"><a href="10-Retour-sur-Shiny.html#cb129-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb129-77"><a href="10-Retour-sur-Shiny.html#cb129-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-78"><a href="10-Retour-sur-Shiny.html#cb129-78" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb129-79"><a href="10-Retour-sur-Shiny.html#cb129-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-80"><a href="10-Retour-sur-Shiny.html#cb129-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-81"><a href="10-Retour-sur-Shiny.html#cb129-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-82"><a href="10-Retour-sur-Shiny.html#cb129-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-83"><a href="10-Retour-sur-Shiny.html#cb129-83" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
<div id="introduction-dune-réactivité-sur-les-inputs-contexte-réactif" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Introduction d’une réactivité sur les inputs (contexte réactif)<a href="10-Retour-sur-Shiny.html#introduction-dune-réactivité-sur-les-inputs-contexte-réactif" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On va maintenant rendre le tableau réactif selon le département choisi.<br />
Mais surtout, on va introduire un contexte réactif. En effet, lorsque l’analyse porte sur Paris, choisir comme type de logement des maisons n’est pas pertinent car il n’y a pratiquement pas de maisons vendues dans Paris, donc on va faire en sorte que lorsque l’utilisateur choisit Paris, il n’est plus le choix du type de logement, seuls les appartements apparaîtront, mais lorsqu’il cliquera sur un autre département, alors les deux types de logements seront de nouveau possible.</p>
<p>On peut pour cela utiliser la fonction <code>observe()</code> : on l’utilise donc quand un input change.<br />
Il va falloir ici utiliser à l’intérieur de la fonction <code>observe()</code> une condition <code>if ... else ...</code> : on part du principe qu’on affiche d’abord automatiquement “Paris”, lorsque l’utilisateur appuie sur le bouton du choix de département du widget <code>radioButtons</code>, le widget <code>selectInput</code> doit être actualisé en permettant un choix unique, “appartements” ; alors que quand il appuie sur un autre département sur le bouton du choix de département du widget <code>radioButtons</code>, le <code>selectInput</code> laisse le choix entre “appartements” et “maisons.</p>
<p>Il faut donc utiliser la fonction <code>observe()</code>, une condition <code>if ... else ...</code> et une actualisation des widgets avec la fonction <code>updateSelectInput()</code>.</p>
<p>L’image suivante vous donne un aperçu de ce qu’on devrait avoir pour Paris :
<img src="images/Ex.2_Shiny.png" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="10-Retour-sur-Shiny.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement du fichier final</span></span>
<span id="cb130-2"><a href="10-Retour-sur-Shiny.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dvf &lt;- readRDS(&quot;data/dvfclean_V3.RDS&quot;)</span></span>
<span id="cb130-3"><a href="10-Retour-sur-Shiny.html#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="10-Retour-sur-Shiny.html#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="10-Retour-sur-Shiny.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb130-6"><a href="10-Retour-sur-Shiny.html#cb130-6" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb130-7"><a href="10-Retour-sur-Shiny.html#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb130-8"><a href="10-Retour-sur-Shiny.html#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements et de maisons dans Paris et sa petite couronne sur la période 2014-2021&quot;</span>),</span>
<span id="cb130-9"><a href="10-Retour-sur-Shiny.html#cb130-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-10"><a href="10-Retour-sur-Shiny.html#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb130-11"><a href="10-Retour-sur-Shiny.html#cb130-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-12"><a href="10-Retour-sur-Shiny.html#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb130-13"><a href="10-Retour-sur-Shiny.html#cb130-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb130-14"><a href="10-Retour-sur-Shiny.html#cb130-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb130-15"><a href="10-Retour-sur-Shiny.html#cb130-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb130-16"><a href="10-Retour-sur-Shiny.html#cb130-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département pour le tableau et le graphique&quot;</span>,</span>
<span id="cb130-17"><a href="10-Retour-sur-Shiny.html#cb130-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(dvf<span class="sc">$</span>nom_dept),</span>
<span id="cb130-18"><a href="10-Retour-sur-Shiny.html#cb130-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Paris&quot;</span>),</span>
<span id="cb130-19"><a href="10-Retour-sur-Shiny.html#cb130-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>, </span>
<span id="cb130-20"><a href="10-Retour-sur-Shiny.html#cb130-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix du type de logement pour le graphique&quot;</span>, </span>
<span id="cb130-21"><a href="10-Retour-sur-Shiny.html#cb130-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb130-22"><a href="10-Retour-sur-Shiny.html#cb130-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb130-23"><a href="10-Retour-sur-Shiny.html#cb130-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb130-24"><a href="10-Retour-sur-Shiny.html#cb130-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb130-25"><a href="10-Retour-sur-Shiny.html#cb130-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb130-26"><a href="10-Retour-sur-Shiny.html#cb130-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb130-27"><a href="10-Retour-sur-Shiny.html#cb130-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb130-28"><a href="10-Retour-sur-Shiny.html#cb130-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb130-29"><a href="10-Retour-sur-Shiny.html#cb130-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb130-30"><a href="10-Retour-sur-Shiny.html#cb130-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb130-31"><a href="10-Retour-sur-Shiny.html#cb130-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb130-32"><a href="10-Retour-sur-Shiny.html#cb130-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb130-33"><a href="10-Retour-sur-Shiny.html#cb130-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb130-34"><a href="10-Retour-sur-Shiny.html#cb130-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb130-35"><a href="10-Retour-sur-Shiny.html#cb130-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb130-36"><a href="10-Retour-sur-Shiny.html#cb130-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-37"><a href="10-Retour-sur-Shiny.html#cb130-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-38"><a href="10-Retour-sur-Shiny.html#cb130-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-39"><a href="10-Retour-sur-Shiny.html#cb130-39" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb130-40"><a href="10-Retour-sur-Shiny.html#cb130-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-41"><a href="10-Retour-sur-Shiny.html#cb130-41" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb130-42"><a href="10-Retour-sur-Shiny.html#cb130-42" aria-hidden="true" tabindex="-1"></a>    dvf <span class="sc">%&gt;%</span> </span>
<span id="cb130-43"><a href="10-Retour-sur-Shiny.html#cb130-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb130-44"><a href="10-Retour-sur-Shiny.html#cb130-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Prix moyen au m2 des maisons, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb130-45"><a href="10-Retour-sur-Shiny.html#cb130-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>nblots),</span>
<span id="cb130-46"><a href="10-Retour-sur-Shiny.html#cb130-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes de maisons&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>nblots)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-47"><a href="10-Retour-sur-Shiny.html#cb130-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb130-48"><a href="10-Retour-sur-Shiny.html#cb130-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-49"><a href="10-Retour-sur-Shiny.html#cb130-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">&#39;Principaux indicateurs sur&#39;</span>, <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Paris&quot;</span>, </span>
<span id="cb130-50"><a href="10-Retour-sur-Shiny.html#cb130-50" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;la Seine-Saint-Denis&quot;</span>,</span>
<span id="cb130-51"><a href="10-Retour-sur-Shiny.html#cb130-51" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;les Hauts-de-Seine&quot;</span>, <span class="st">&quot;le Val-de-Marne&quot;</span>)))))</span>
<span id="cb130-52"><a href="10-Retour-sur-Shiny.html#cb130-52" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb130-53"><a href="10-Retour-sur-Shiny.html#cb130-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-54"><a href="10-Retour-sur-Shiny.html#cb130-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb130-55"><a href="10-Retour-sur-Shiny.html#cb130-55" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>dept</span>
<span id="cb130-56"><a href="10-Retour-sur-Shiny.html#cb130-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="sc">$</span>dept <span class="sc">==</span> <span class="st">&quot;Paris&quot;</span>){</span>
<span id="cb130-57"><a href="10-Retour-sur-Shiny.html#cb130-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>,</span>
<span id="cb130-58"><a href="10-Retour-sur-Shiny.html#cb130-58" aria-hidden="true" tabindex="-1"></a>                        <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>),</span>
<span id="cb130-59"><a href="10-Retour-sur-Shiny.html#cb130-59" aria-hidden="true" tabindex="-1"></a>                        <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb130-60"><a href="10-Retour-sur-Shiny.html#cb130-60" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb130-61"><a href="10-Retour-sur-Shiny.html#cb130-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {<span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>,</span>
<span id="cb130-62"><a href="10-Retour-sur-Shiny.html#cb130-62" aria-hidden="true" tabindex="-1"></a>                            <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb130-63"><a href="10-Retour-sur-Shiny.html#cb130-63" aria-hidden="true" tabindex="-1"></a>                            <span class="at">selected =</span> input<span class="sc">$</span>variable)</span>
<span id="cb130-64"><a href="10-Retour-sur-Shiny.html#cb130-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb130-65"><a href="10-Retour-sur-Shiny.html#cb130-65" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb130-66"><a href="10-Retour-sur-Shiny.html#cb130-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-67"><a href="10-Retour-sur-Shiny.html#cb130-67" aria-hidden="true" tabindex="-1"></a>  dvf_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb130-68"><a href="10-Retour-sur-Shiny.html#cb130-68" aria-hidden="true" tabindex="-1"></a>  dvf <span class="sc">%&gt;%</span> </span>
<span id="cb130-69"><a href="10-Retour-sur-Shiny.html#cb130-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> input<span class="sc">$</span>type_logement <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb130-70"><a href="10-Retour-sur-Shiny.html#cb130-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom) <span class="sc">%&gt;%</span>  </span>
<span id="cb130-71"><a href="10-Retour-sur-Shiny.html#cb130-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">moy_prixm2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(prixm2))) <span class="sc">%&gt;%</span> </span>
<span id="cb130-72"><a href="10-Retour-sur-Shiny.html#cb130-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(moy_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb130-73"><a href="10-Retour-sur-Shiny.html#cb130-73" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb130-74"><a href="10-Retour-sur-Shiny.html#cb130-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-75"><a href="10-Retour-sur-Shiny.html#cb130-75" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb130-76"><a href="10-Retour-sur-Shiny.html#cb130-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dvf_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-77"><a href="10-Retour-sur-Shiny.html#cb130-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> moy_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom, moy_prixm2))  <span class="sc">+</span> </span>
<span id="cb130-78"><a href="10-Retour-sur-Shiny.html#cb130-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb130-79"><a href="10-Retour-sur-Shiny.html#cb130-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>moy_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb130-80"><a href="10-Retour-sur-Shiny.html#cb130-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des communes ayant les prix moyens au m2 des </span><span class="sc">\n</span><span class="st">ventes&quot;</span>, </span>
<span id="cb130-81"><a href="10-Retour-sur-Shiny.html#cb130-81" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span>(input<span class="sc">$</span>type_logement<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>){<span class="st">&quot;d&#39;appartements&quot;</span>} <span class="cf">else</span>{<span class="st">&quot;de maisons&quot;</span>}, <span class="st">&quot;les plus élevés&quot;</span>,</span>
<span id="cb130-82"><a href="10-Retour-sur-Shiny.html#cb130-82" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;dans Paris&quot;</span>, </span>
<span id="cb130-83"><a href="10-Retour-sur-Shiny.html#cb130-83" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;en Seine-Saint-Denis&quot;</span>,</span>
<span id="cb130-84"><a href="10-Retour-sur-Shiny.html#cb130-84" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans les Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans le Val-de-Marne&quot;</span>)))),</span>
<span id="cb130-85"><a href="10-Retour-sur-Shiny.html#cb130-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb130-86"><a href="10-Retour-sur-Shiny.html#cb130-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2014-2021.&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-87"><a href="10-Retour-sur-Shiny.html#cb130-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb130-88"><a href="10-Retour-sur-Shiny.html#cb130-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb130-89"><a href="10-Retour-sur-Shiny.html#cb130-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb130-90"><a href="10-Retour-sur-Shiny.html#cb130-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb130-91"><a href="10-Retour-sur-Shiny.html#cb130-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb130-92"><a href="10-Retour-sur-Shiny.html#cb130-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb130-93"><a href="10-Retour-sur-Shiny.html#cb130-93" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb130-94"><a href="10-Retour-sur-Shiny.html#cb130-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-95"><a href="10-Retour-sur-Shiny.html#cb130-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb130-96"><a href="10-Retour-sur-Shiny.html#cb130-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-97"><a href="10-Retour-sur-Shiny.html#cb130-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-98"><a href="10-Retour-sur-Shiny.html#cb130-98" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>On peut ajouter un second graphique donnant une information sur l’évolution des prix moyen au m2 par type de logement et département sur la période étudiée.</p>
<p>L’image suivante vous donne un aperçu de ce qu’on devrait avoir :
<img src="images/Ex.3_Shiny.png" /></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="10-Retour-sur-Shiny.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb131-2"><a href="10-Retour-sur-Shiny.html#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="10-Retour-sur-Shiny.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement du fichier final</span></span>
<span id="cb131-4"><a href="10-Retour-sur-Shiny.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dvf &lt;- readRDS(&quot;data/dvfclean_V3.RDS&quot;)</span></span>
<span id="cb131-5"><a href="10-Retour-sur-Shiny.html#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="10-Retour-sur-Shiny.html#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="10-Retour-sur-Shiny.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb131-8"><a href="10-Retour-sur-Shiny.html#cb131-8" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb131-9"><a href="10-Retour-sur-Shiny.html#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb131-10"><a href="10-Retour-sur-Shiny.html#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements et de maisons dans Paris et sa petite couronne sur la période 2014-2021&quot;</span>),</span>
<span id="cb131-11"><a href="10-Retour-sur-Shiny.html#cb131-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb131-12"><a href="10-Retour-sur-Shiny.html#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb131-13"><a href="10-Retour-sur-Shiny.html#cb131-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb131-14"><a href="10-Retour-sur-Shiny.html#cb131-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb131-15"><a href="10-Retour-sur-Shiny.html#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb131-16"><a href="10-Retour-sur-Shiny.html#cb131-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb131-17"><a href="10-Retour-sur-Shiny.html#cb131-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb131-18"><a href="10-Retour-sur-Shiny.html#cb131-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département pour le tableau et le graphique&quot;</span>,</span>
<span id="cb131-19"><a href="10-Retour-sur-Shiny.html#cb131-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(dvf<span class="sc">$</span>nom_dept),</span>
<span id="cb131-20"><a href="10-Retour-sur-Shiny.html#cb131-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Paris&quot;</span>),</span>
<span id="cb131-21"><a href="10-Retour-sur-Shiny.html#cb131-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>, </span>
<span id="cb131-22"><a href="10-Retour-sur-Shiny.html#cb131-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix du type de logement pour le graphique du &#39;Top 5&#39;&quot;</span>, </span>
<span id="cb131-23"><a href="10-Retour-sur-Shiny.html#cb131-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb131-24"><a href="10-Retour-sur-Shiny.html#cb131-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb131-25"><a href="10-Retour-sur-Shiny.html#cb131-25" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb131-26"><a href="10-Retour-sur-Shiny.html#cb131-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb131-27"><a href="10-Retour-sur-Shiny.html#cb131-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb131-28"><a href="10-Retour-sur-Shiny.html#cb131-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb131-29"><a href="10-Retour-sur-Shiny.html#cb131-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb131-30"><a href="10-Retour-sur-Shiny.html#cb131-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb131-31"><a href="10-Retour-sur-Shiny.html#cb131-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb131-32"><a href="10-Retour-sur-Shiny.html#cb131-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">splitLayout</span>(<span class="at">cellWidths =</span> <span class="fu">c</span>(<span class="st">&quot;55%&quot;</span>, <span class="st">&quot;45%&quot;</span>),</span>
<span id="cb131-33"><a href="10-Retour-sur-Shiny.html#cb131-33" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>,  <span class="at">height =</span> <span class="dv">400</span>, <span class="at">width =</span> <span class="dv">500</span>),</span>
<span id="cb131-34"><a href="10-Retour-sur-Shiny.html#cb131-34" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">plotOutput</span>(<span class="st">&quot;courbe&quot;</span>,  <span class="at">height =</span> <span class="dv">400</span>, <span class="at">width =</span> <span class="dv">400</span>))</span>
<span id="cb131-35"><a href="10-Retour-sur-Shiny.html#cb131-35" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb131-36"><a href="10-Retour-sur-Shiny.html#cb131-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb131-37"><a href="10-Retour-sur-Shiny.html#cb131-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb131-38"><a href="10-Retour-sur-Shiny.html#cb131-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb131-39"><a href="10-Retour-sur-Shiny.html#cb131-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-40"><a href="10-Retour-sur-Shiny.html#cb131-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-41"><a href="10-Retour-sur-Shiny.html#cb131-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-42"><a href="10-Retour-sur-Shiny.html#cb131-42" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb131-43"><a href="10-Retour-sur-Shiny.html#cb131-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb131-44"><a href="10-Retour-sur-Shiny.html#cb131-44" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb131-45"><a href="10-Retour-sur-Shiny.html#cb131-45" aria-hidden="true" tabindex="-1"></a>    dvf <span class="sc">%&gt;%</span> </span>
<span id="cb131-46"><a href="10-Retour-sur-Shiny.html#cb131-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb131-47"><a href="10-Retour-sur-Shiny.html#cb131-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Prix moyen au m2 des maisons, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>prixm2)),</span>
<span id="cb131-48"><a href="10-Retour-sur-Shiny.html#cb131-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>nblots),</span>
<span id="cb131-49"><a href="10-Retour-sur-Shiny.html#cb131-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Nombre de ventes de maisons&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(dvf[dvf<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;Maison&quot;</span> <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept, ]<span class="sc">$</span>nblots)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-50"><a href="10-Retour-sur-Shiny.html#cb131-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb131-51"><a href="10-Retour-sur-Shiny.html#cb131-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-52"><a href="10-Retour-sur-Shiny.html#cb131-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">&quot;Principaux indicateurs sur l&#39;ensemble de la période sur&quot;</span>, </span>
<span id="cb131-53"><a href="10-Retour-sur-Shiny.html#cb131-53" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Paris&quot;</span>, </span>
<span id="cb131-54"><a href="10-Retour-sur-Shiny.html#cb131-54" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;la Seine-Saint-Denis&quot;</span>,</span>
<span id="cb131-55"><a href="10-Retour-sur-Shiny.html#cb131-55" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;les Hauts-de-Seine&quot;</span>, <span class="st">&quot;le Val-de-Marne&quot;</span>)))))</span>
<span id="cb131-56"><a href="10-Retour-sur-Shiny.html#cb131-56" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb131-57"><a href="10-Retour-sur-Shiny.html#cb131-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-58"><a href="10-Retour-sur-Shiny.html#cb131-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb131-59"><a href="10-Retour-sur-Shiny.html#cb131-59" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>dept</span>
<span id="cb131-60"><a href="10-Retour-sur-Shiny.html#cb131-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="sc">$</span>dept <span class="sc">==</span> <span class="st">&quot;Paris&quot;</span>){</span>
<span id="cb131-61"><a href="10-Retour-sur-Shiny.html#cb131-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>,</span>
<span id="cb131-62"><a href="10-Retour-sur-Shiny.html#cb131-62" aria-hidden="true" tabindex="-1"></a>                        <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>),</span>
<span id="cb131-63"><a href="10-Retour-sur-Shiny.html#cb131-63" aria-hidden="true" tabindex="-1"></a>                        <span class="at">selected =</span> <span class="st">&quot;Appartement&quot;</span>)</span>
<span id="cb131-64"><a href="10-Retour-sur-Shiny.html#cb131-64" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb131-65"><a href="10-Retour-sur-Shiny.html#cb131-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {<span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;type_logement&quot;</span>,</span>
<span id="cb131-66"><a href="10-Retour-sur-Shiny.html#cb131-66" aria-hidden="true" tabindex="-1"></a>                            <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;Appartement&quot;</span>, <span class="st">&quot;Maison&quot;</span>),</span>
<span id="cb131-67"><a href="10-Retour-sur-Shiny.html#cb131-67" aria-hidden="true" tabindex="-1"></a>                            <span class="at">selected =</span> input<span class="sc">$</span>variable)</span>
<span id="cb131-68"><a href="10-Retour-sur-Shiny.html#cb131-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb131-69"><a href="10-Retour-sur-Shiny.html#cb131-69" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb131-70"><a href="10-Retour-sur-Shiny.html#cb131-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb131-71"><a href="10-Retour-sur-Shiny.html#cb131-71" aria-hidden="true" tabindex="-1"></a>  dvf_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb131-72"><a href="10-Retour-sur-Shiny.html#cb131-72" aria-hidden="true" tabindex="-1"></a>  dvf <span class="sc">%&gt;%</span> </span>
<span id="cb131-73"><a href="10-Retour-sur-Shiny.html#cb131-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> input<span class="sc">$</span>type_logement <span class="sc">&amp;</span> nom_dept <span class="sc">==</span> input<span class="sc">$</span>dept) </span>
<span id="cb131-74"><a href="10-Retour-sur-Shiny.html#cb131-74" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb131-75"><a href="10-Retour-sur-Shiny.html#cb131-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-76"><a href="10-Retour-sur-Shiny.html#cb131-76" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb131-77"><a href="10-Retour-sur-Shiny.html#cb131-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dvf_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb131-78"><a href="10-Retour-sur-Shiny.html#cb131-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(nom) <span class="sc">%&gt;%</span>  </span>
<span id="cb131-79"><a href="10-Retour-sur-Shiny.html#cb131-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">moy_prixm2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(prixm2))) <span class="sc">%&gt;%</span> </span>
<span id="cb131-80"><a href="10-Retour-sur-Shiny.html#cb131-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(moy_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-81"><a href="10-Retour-sur-Shiny.html#cb131-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb131-82"><a href="10-Retour-sur-Shiny.html#cb131-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> moy_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom, moy_prixm2))  <span class="sc">+</span> </span>
<span id="cb131-83"><a href="10-Retour-sur-Shiny.html#cb131-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb131-84"><a href="10-Retour-sur-Shiny.html#cb131-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>moy_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb131-85"><a href="10-Retour-sur-Shiny.html#cb131-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des communes ayant les prix moyens </span><span class="sc">\n</span><span class="st">au m2 des ventes&quot;</span>, </span>
<span id="cb131-86"><a href="10-Retour-sur-Shiny.html#cb131-86" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span>(input<span class="sc">$</span>type_logement<span class="sc">==</span><span class="st">&quot;Appartement&quot;</span>){<span class="st">&quot;d&#39;appartements&quot;</span>} <span class="cf">else</span>{<span class="st">&quot;de maisons&quot;</span>}, <span class="st">&quot;les plus </span><span class="sc">\n</span><span class="st">élevés&quot;</span>,</span>
<span id="cb131-87"><a href="10-Retour-sur-Shiny.html#cb131-87" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;dans Paris&quot;</span>, </span>
<span id="cb131-88"><a href="10-Retour-sur-Shiny.html#cb131-88" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;en Seine-Saint-Denis&quot;</span>,</span>
<span id="cb131-89"><a href="10-Retour-sur-Shiny.html#cb131-89" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans les Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans le Val-de-Marne&quot;</span>)))),</span>
<span id="cb131-90"><a href="10-Retour-sur-Shiny.html#cb131-90" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb131-91"><a href="10-Retour-sur-Shiny.html#cb131-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2014-2021.&quot;</span>) <span class="sc">+</span></span>
<span id="cb131-92"><a href="10-Retour-sur-Shiny.html#cb131-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb131-93"><a href="10-Retour-sur-Shiny.html#cb131-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>),</span>
<span id="cb131-94"><a href="10-Retour-sur-Shiny.html#cb131-94" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="fl">11.5</span>),</span>
<span id="cb131-95"><a href="10-Retour-sur-Shiny.html#cb131-95" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb131-96"><a href="10-Retour-sur-Shiny.html#cb131-96" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>))</span>
<span id="cb131-97"><a href="10-Retour-sur-Shiny.html#cb131-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb131-98"><a href="10-Retour-sur-Shiny.html#cb131-98" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb131-99"><a href="10-Retour-sur-Shiny.html#cb131-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb131-100"><a href="10-Retour-sur-Shiny.html#cb131-100" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>courbe <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb131-101"><a href="10-Retour-sur-Shiny.html#cb131-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dvf_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb131-102"><a href="10-Retour-sur-Shiny.html#cb131-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(ann) <span class="sc">%&gt;%</span> </span>
<span id="cb131-103"><a href="10-Retour-sur-Shiny.html#cb131-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">moy_prixm2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(prixm2),<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-104"><a href="10-Retour-sur-Shiny.html#cb131-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(moy_prixm2, ann) <span class="sc">%&gt;%</span> </span>
<span id="cb131-105"><a href="10-Retour-sur-Shiny.html#cb131-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb131-106"><a href="10-Retour-sur-Shiny.html#cb131-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>ann, <span class="at">y=</span>moy_prixm2) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">group=</span><span class="dv">1</span>, <span class="at">linewidth=</span><span class="fl">0.7</span>)  <span class="sc">+</span></span>
<span id="cb131-107"><a href="10-Retour-sur-Shiny.html#cb131-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Evolution du prix moyen au m2 des appartements </span><span class="sc">\n</span><span class="st">vendus&quot;</span>, </span>
<span id="cb131-108"><a href="10-Retour-sur-Shiny.html#cb131-108" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;à Paris&quot;</span>, </span>
<span id="cb131-109"><a href="10-Retour-sur-Shiny.html#cb131-109" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Seine-Saint-Denis&quot;</span>, <span class="st">&quot;en Seine-Saint-Denis&quot;</span>,</span>
<span id="cb131-110"><a href="10-Retour-sur-Shiny.html#cb131-110" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>dept<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans les Hauts-de-Seine&quot;</span>, <span class="st">&quot;dans le Val-de-Marne&quot;</span>)))), <span class="at">x =</span> <span class="st">&quot; &quot;</span>, <span class="at">y =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb131-111"><a href="10-Retour-sur-Shiny.html#cb131-111" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2014-2021.&quot;</span>) <span class="sc">+</span></span>
<span id="cb131-112"><a href="10-Retour-sur-Shiny.html#cb131-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>), </span>
<span id="cb131-113"><a href="10-Retour-sur-Shiny.html#cb131-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">size=</span><span class="fl">11.5</span>),</span>
<span id="cb131-114"><a href="10-Retour-sur-Shiny.html#cb131-114" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb131-115"><a href="10-Retour-sur-Shiny.html#cb131-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>))</span>
<span id="cb131-116"><a href="10-Retour-sur-Shiny.html#cb131-116" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb131-117"><a href="10-Retour-sur-Shiny.html#cb131-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-118"><a href="10-Retour-sur-Shiny.html#cb131-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-119"><a href="10-Retour-sur-Shiny.html#cb131-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-120"><a href="10-Retour-sur-Shiny.html#cb131-120" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<!-- 
D'abord, comme lors d'un précédent exemple Shiny, lorsque le nom de la variable était de type "string" (chaîne de caractères) dans les choix du widget on avait dû utiliser la fonction `aes_string()` au lieu du simple `aes()` dans **Ggplot** ; ici, de même, on a dû utiliser un autre code qu'habituellement pour appeler la variable `input$variable` dans la fonction `group_by()` : les doubles `!!` (appelés "bang-bang") et la fonction `sym()`. Ce code fait plus précisément deux choses : il convertit d'abord la chaîne de caractères fournie par `input$variable` en un symbole en utilisant la fonction `sym()`, puis il utilise l'opérateur `!!` qui est une syntaxe d'évaluation qui permet ici d'enlever les guillemets ('unquoting'), en gros il permet ici de dire à la fonction `group_by` "OK, maintenant évalue l'expression que je t'ai donnée et substitue le bon résultat à la place". À savoir, on aurait pu aussi utiliser, à la place de `group_by()`, la fonction `group_by_at()` en appelant directement dans ce cas l'`input$variable` dans les parenthèses.   
Il faut donc *faire attention* à la manière dont sont définis les choix de variables dans la fonction `UI` : si ce sont des chaînes de caractères ('string') alors certaines fonctions de `**R-base**` ou de `**tidyverse**` ne pourront pas s'y appliquer directement, il faudra soit transformer ces variables à l'aide notamment de la double-fonction `!!sym()`, soit trouver une fonction proche qui fonctionne avec ce type de variable 'string' comme `aes_string()` dans `**Ggpplot**` ou `group_by_at()`.

Ensuite, on a utilisé du langage html pour que le graphique soit adapté à la fenêtre et donc modifier sa taille, on a utilisé les options `height=` et `width=` indiquées dans la fonction `plotOutput()` (il est possible également de les indiquer à la fin de la fonction `renderPlot({})` entre le `{` et la dernière `)`).   
-->
<!--
## Introduction d'une réactivité sur les inputs ET les outputs
Dans la continuité, on souhaite changer le graphique pour que, lorsqu'on se situe au niveau régional, on ait cette fois le graphique du Top 5 des aides versées selon les départements de la région choisie, alors que précédemment cela nous indiquait les 5 premiers départements toutes régions confondues.  
Il faut donc d'abord ajouter un widget `selectInput` qui initialement (lorsqu'on est au niveau "National") ne prenne aucune valeur, mais lorsqu'on sera sur le niveau régional, on l'actualise pour avoir le choix d'une région. Il faut donc dans la fonction `observe()` actualiser 2 widgets maintenant.  
Ensuite, on va modifier notre base de données réactive en ajoutant un filtre selon la région choisie : mais ce filtre ne doit s'appliquer que lorsque l'utilisateur est au niveau "Régional", il faut pour cela introduire dans la fonction `filter()` une condition `if(input$niveau_analyse == "Régional") (reg_name %in% input$choix_region) else TRUE`. -->

</div>
</div>






<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="09-Ggplot-pratique.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Camille-Sisi/github.io-Data-Mining-2023/master/10-Retour-sur-Shiny.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
